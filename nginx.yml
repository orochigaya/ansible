---
 - hosts: Debian
   vars:
    user: dev
    rep: local.dev

   tasks:
    - name: update debian
      apt: 
       update_cache=yes
    - name: desinstallation apache2
      apt:
       name: apache2
       state: absent 
    - name: installation nginx
      apt: 
       name: nginx
       state: present
    - name: restart and enable nginx
      systemd:
       name: nginx
       state: restarted
       enabled: yes
    - name: Create a login user                                                                   
      user:                                                                                       
       name: '{{ user }}'                                                                                
       shell: /bin/zsh                                                                            
       state: present 
    - name: "creation repertoire local.dev"
      file:
       path: /home/{{ user }}/{{ rep }}
       state: directory
    - name: lien symbolique
      file: 
       src: /home/dev/{{ rep }} 
       dest: /var/www/html/{{ rep }} 
       state: link
    - name: utilisation template
      template: src=/etc/ansible/templates/nginx.j2 dest=/etc/nginx/sites-available/{{ rep }}
    - name: lien symbolique nginx
      file:
       src: /etc/nginx/sites-available/{{ rep }}
       dest: /etc/nginx/sites-enabled/{{ rep }}
       state: link    
    - name: Suppression default
      file:
       path: /etc/nginx/sites-available/default
       state: absent
